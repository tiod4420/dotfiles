# Binding settings

# Prefix bindings
unbind-key -T prefix -a
set-option -g prefix C-b

# Prefix key
bind-key -N "Send the prefix key"                             -r C-b     { send-prefix }
# Lowercase letter keys
bind-key -N "Create a new window"                             'c'        { new-window -a -c "#{pane_current_path}" }
bind-key -N "Detach the current client"                       'd'        { detach-client }
bind-key -N "Select the top-left pane"                        'g'        { select-pane -t '{top-left}' }
bind-key -N "Select the pane before the active pane"          'h'        { select-pane -L }
bind-key -N "Select the pane below the active pane"           'j'        { select-pane -D }
bind-key -N "Select the pane above the active pane"           'k'        { select-pane -U }
bind-key -N "Select the pane after the active pane"           'l'        { select-pane -R }
bind-key -N "Toggle the marked pane"                          'm'        { select-pane -m }
bind-key -N "Swap the active pane with the marked pane"       'o'        { swap-pane }
bind-key -N "Paste the most recent paste buffer"              'p'        { paste-buffer -p }
bind-key -N "Display pane numbers"                            'q'        { display-panes }
bind-key -N "Rename active window"                            'r'        { command-prompt "rename-window -- '%%'" }
bind-key -N "Split window horizontally"                       's'        { split-window -v -c "#{pane_current_path}" }
bind-key -N "Show a clock"                                    't'        { clock-mode }
bind-key -N "Split window vertically"                         'v'        { split-window -h -c "#{pane_current_path}" }
bind-key -N "Kill the active pane"                            'w'        { confirm-before -p "kill-pane #P? (y/n)" kill-pane }
bind-key -N "Toggle display of status line"                   'x'        { set-option -g status }
bind-key -N "Enter copy mode"                                 'y'        { copy-mode }
bind-key -N "Suspend the current client"                      'z'        { suspend-client }
# Uppercase letter keys
bind-key -N "Select the bottom-right pane"                    'G'        { select-pane -t '{bottom-right}' }
bind-key -N "Clear the marked pane"                           'M'        { select-pane -M }
bind-key -N "Swap the window with the marked pane window"     'O'        { swap-window }
bind-key -N "Rename current session"                          'R'        { command-prompt "rename-session -- '%%'" }
bind-key -N "Kill active window"                              'W'        { confirm-before -p "kill-window #W? (y/n)" kill-window }
# Number row keys
bind-key -N "Select window 1"                                 '1'        { select-window -t :=1 }
bind-key -N "Select window 2"                                 '2'        { select-window -t :=2 }
bind-key -N "Select window 3"                                 '3'        { select-window -t :=3 }
bind-key -N "Select window 4"                                 '4'        { select-window -t :=4 }
bind-key -N "Select window 5"                                 '5'        { select-window -t :=5 }
bind-key -N "Select window 6"                                 '6'        { select-window -t :=6 }
bind-key -N "Select window 7"                                 '7'        { select-window -t :=7 }
bind-key -N "Select window 8"                                 '8'        { select-window -t :=8 }
bind-key -N "Select window 9"                                 '9'        { select-window -t :=9 }
bind-key -N "Select window 10"                                '0'        { select-window -t :=10 }
# Number row special character keys
bind-key -N "Break pane to a new window"                      '!'        { break-pane -a }
bind-key -N "Merge the marked pane into active window"        '@'        { join-pane -h }
bind-key -N "Choose a window from a list"                     '#'        { choose-tree -Zw }
bind-key -N "Select last window"                              '$'        { select-window -t :'{end}' }
bind-key -N "Select the previously active window"             '%'        { last-window }
bind-key -N "Select first window"                             '^'        { select-window -t :'{first}' }
bind-key -N "Merge target session into current session"       '&'        { command-prompt -p "Session to merge with: " { run-shell "tmux list-windows -t %% -F '##{session_name}:##{window_index}' | xargs -I{} -n1 tmux move-window -s {}" } }
bind-key -N "Select the previous window"                      '('        { previous-window }
bind-key -N "Select the next window"                          ')'        { next-window }
bind-key -N "Zoom the active pane"                            '_'        { resize-pane -Z }
bind-key -N "Spread panes out evenly"                         '='        { select-layout -E }
bind-key -N "Select a 2:1 horizontal layout"                  '\'        { select-pane -m ; select-pane -t '{top-left}' ; resize-pane -x 66% ; select-pane -t '{marked}' ; select-pane -M }
bind-key -N "Select the even horizontal layout"               '|'        { select-layout even-horizontal }
bind-key -N "Select next layout"                              '`'        { next-layout }
# Right side keys
bind-key -N "Swap the active window with the previous window" '['        { swap-window -d -t -1 }
bind-key -N "Swap the active window with the next window"     ']'        { swap-window -d -t +1 }
bind-key -N "Prompt for a command"                            ':'        { command-prompt }
bind-key -N "Choose a paste buffer from a list"               '"'        { choose-buffer -Z }
bind-key -N "Select the marked pane"                          ','        { select-window -t '{marked}' ; select-pane -t '{marked}' }
bind-key -N "Move to the previously active pane"              '.'        { last-pane }
bind-key -N "Swap the active pane with the pane above"        '<'        { swap-pane -U }
bind-key -N "Swap the active pane with the pane below"        '>'        { swap-pane -D }
bind-key -N "List copy-mode-vi key bindings"                  '/'        { list-keys -T copy-mode-vi }
bind-key -N "List key bindings"                               '?'        { list-keys -N }
# Arrow keys
bind-key -N "Resize the pane up by 5"                         -r Up      { resize-pane -U 5 }
bind-key -N "Resize the pane down by 5"                       -r Down    { resize-pane -D 5 }
bind-key -N "Resize the pane left by 5"                       -r Left    { resize-pane -L 5 }
bind-key -N "Resize the pane right by 5"                      -r Right   { resize-pane -R 5 }
bind-key -N "Resize the pane up"                              -r S-Up    { resize-pane -U }
bind-key -N "Resize the pane down"                            -r S-Down  { resize-pane -D }
bind-key -N "Resize the pane left"                            -r S-Left  { resize-pane -L }
bind-key -N "Resize the pane right"                           -r S-Right { resize-pane -R }

# Vi copy mode bindings
unbind -T copy-mode-vi M-x

bind-key -T copy-mode-vi 'v'               { send-keys -X begin-selection }
bind-key -T copy-mode-vi 'x'               { send-keys -X set-mark }
bind-key -T copy-mode-vi 'y'               { send-keys -X copy-pipe }
bind-key -T copy-mode-vi 'X'               { send-keys -X jump-to-mark }
bind-key -T copy-mode-vi '/'               { command-prompt -i -I "#{pane_search_string}" -p "(search down)" "send -X search-forward-incremental '%%%'" }
bind-key -T copy-mode-vi '?'               { command-prompt -i -I "#{pane_search_string}" -p "(search up)" "send -X search-backward-incremental '%%%'" }
bind-key -T copy-mode-vi MouseDragEnd1Pane { send-keys -X copy-pipe-no-clear }

# Mouse scrolling in alternate pane, or for git (which has -FXR
bind-key -T root WheelUpPane {
	if -F "#{||:#{pane_in_mode},#{mouse_any_flag}}" {
		send-keys -M
	} {
		if -F "#{||:#{alternate_on},#{==:#{pane_current_command},git}}" {
			send-keys Up
		} {
			copy-mode -e
		}
	}
}

bind-key -T root WheelDownPane {
	if -F "#{||:#{pane_in_mode},#{mouse_any_flag}}" {
		send-keys -M
	} {
		if -F "#{||:#{alternate_on},#{==:#{pane_current_command},git}}" {
			send-keys Down
		} {
			send-keys -M
		}
	}
}
